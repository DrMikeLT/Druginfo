---
title: "First Graph"
author: "Michael Turner"
date: "2/2/2019"
output:
  word_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

## Top Percribed Drugs

This graph shows the 1,424 perscribed drugs based on Medicare Part D data released from
Medicare for 2017. This information is combined with numerical drug reviews provided by users of Drugs.com and Druglib.com, which both allow people to provide Amazon style drug reviews on a ten point scale along with comments.

The x-axis of this graph is the average rating for these drugs binned in buckets, while the y-axis shows the per-pill cost to Medicare. 

```{r full, echo=false}

#load(file="joined_review_and_cost_files.r")
drugs<-randc %>%
  #filter(supply >1000000) %>%
  group_by(drug) %>%
  summarise(good=sum(good),
            bad=sum(bad),
            rate=mean(rating),
            supply=sum(supply),
            cost=sum(cost),
            percost=sum(cost)/sum(supply)) #%>%


drugs %>%
  #filter(percost<150) %>%
  ggplot( aes(rate, percost)) +
  geom_boxplot(aes(cut_width(rate, 1))) +
  theme_classic()+
  scale_y_continuous(name="Per Pill Cost",
                     breaks=c(0,5000,10000,15000,20000 ),
                     labels=c("$0", "$5k", "$10k", "$15k","$20k"))+
  scale_x_discrete(name="Average Drug Review Raings", labels= c("<1.5",
                                                                "1.5-2.5", "2.5-3.5",
                                                                "3.5-4.5", "4.5-5.5",
                                                                "5.5-6.5", "6.5-7.5",
                                                                "7.5-8.5", "8.5-9.5",
                                                                ">9.5"))+
  ggtitle("Per Pill Cost of 1,424 Medicare Covered Drugs by User Ratings")
```

Obviously a few high cost outlier pills make this graph hard to read.  But there is some good news here for drug marketers, the highest cost drugs mostly have high ratings. The one exception is Firazyr which has an average rating of 6.25 and costs 13,166 a pill.  This drug, which is used to treat angiodema, is a major competitor to kalbitor (average rating of 10, cost 19,281/pill)

```{r cars, echo=false}
#load(file="joined_review_and_cost_files.r")


library(tidyverse)
drugs<-randc %>%
  #filter(supply >1000000) %>%
  group_by(drug) %>%
  summarise(good=sum(good),
            bad=sum(bad),
            rate=mean(rating),
            supply=sum(supply),
            cost=sum(cost),
            percost=sum(cost)/sum(supply)) #%>%

 
drugs %>%
  filter(percost<150) %>%
  ggplot( aes(rate, percost)) +
  geom_boxplot(aes(cut_width(rate, 1))) +
  theme_classic()+
  scale_y_continuous(name="Per Pill Cost (Drugs less than $150",
                     breaks=c(0,25,50,75,100,125, 150 ),
                      labels=c("$0", "$25", "$50", "$75","$100","$125" ,"$150"))+
  scale_x_discrete(name="Average Drug Review Raings", labels= c("<1.5",
                                                                "1.5-2.5", "2.5-3.5",
                                                                "3.5-4.5", "4.5-5.5",
                                                                "5.5-6.5", "6.5-7.5",
                                                                "7.5-8.5", "8.5-9.5",
                                                                ">9.5"))+
  ggtitle("Per Pill Cost of 1,301 Medicare Covered Drugs by User Ratings")
  

```

